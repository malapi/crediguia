<!DOCTYPE HTML>
<html>
<head>
    <title>Home</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="jqmobile/themes/crediguia.min.css" />
	<link rel="stylesheet" href="jqmobile/themes/jquery.mobile.icons.min.css" />
	
    <link rel="stylesheet" href="jqmobile/jquery.mobile.structure-1.4.5.min.css" />
    
    <script src="jqmobile/jquery.min.js"></script>
    <script src="jqmobile/jquery.mobile-1.4.5.min.js"></script>
	<script src="js/utiles.js"></script>
    <link rel="stylesheet" href="css/propios.css" />
<style type="text/css">

</style>
    
</head>
<body>

<!-- Start of first page -->
<div data-role="page" id="home">
    <div role="main" class="ui-content">

        <div class="div_contenido">
        <center><img alt="Crediguia" src="images/tarjeta.png" width="50%"></center>
        <center><img alt="Crediguia" src="images/lausas.png" width="50%"></center>
		
		</div>
		<div class="div_contenido">
		<div class="ui-grid-solo">
    		<div class="ui-block-a">
				<input type="button" data-theme="b" value="Ingresar" onclick="javascript:verificarLogin('loginVolver');">
			</div>
		</div>
            <div class="ui-grid-solo">
                    		<div class="ui-block-a">
                <input type="button" data-theme="b" value="Cerrar Sesion" onclick="javascript:cerrarSession('#login');">
            </div>
            </div>
		<div class="ui-grid-solo">
    		<div class="ui-block-a"><center><a href="#">Teléfonos &uacute;tiles</a></center></div>
		</div>
		<div class="ui-grid-solo">
    		<div class="ui-block-a"><center><a href="#">Locales Adheridos</a></center></div>
		</div>
		</div>
		
        
    </div><!-- /content -->
</div><!-- /page -->

<!-- Start of second page -->
<div data-role="page" id="login">
    <div role="main" class="ui-content">

        <div class="div_contenido">
        	<center><img alt="Crediguia" src="images/tarjeta.png" width="50%"></center>
        	<center><img alt="Crediguia" src="images/lausas.png" width="50%"></center>
		</div>
		<div class="div_contenido">
            <form id="formLogin" name="formLogin">
			<div id="transparent"  data-theme="b" data-shadow="false">
					  <label for="txtdni" class="ui-hidden-accessible">EMAIL:</label>
					  <input type="text" name="txtcorreo" id="txtdni" placeholder="DNI" value="">
						<label for="txtpass" class="ui-hidden-accessible">CONTRASEÑA:</label>
						<input type="password" name="txtpass" id="txtpass" placeholder="CONTRASEÑA" value="">
						<label for="submit-4" class="ui-hidden-accessible">Send:</label>
						<button  data-theme="b"  id="submit-4" onclick="javascript:login('loginVolver');" >Ingresar</button>
				</div>
                </form>
		<p>Ingrese la misma contraseña que ingresa en el sitio web<p>
		</div>
		
        
    </div><!-- /content -->
</div><!-- /page -->
<!-- Start of tercera page -->
<div data-role="page" id="bienvenida">
			<div class="CabeceraPrincipal"> </div>
      <div role="main" class="ui-content">
    	<div class="div_contenido">
            <h2>Limites y Disponibles</h2>
            <h4 style="text-align: left;">Total:  </h4>
            <div data-role="navbar" >
                <ul>
                    <li><a href="#" data-theme="a" id="TotalLimite" >Limite: <br> #IMPORTE </a></li>
                    <li><a href="#" data-theme="b" id="TotalDisponible">Disponible: <br> #IMPORTE</a></li>
                </ul>
            </div>
            <h4 style="text-align: left;">Diferencial:  </h4>
            <div data-role="navbar" >
                <ul>
                    <li><a href="#" data-theme="a" id="DiferencialLimite" >Limite: <br> #IMPORTE </a></li>
                    <li><a href="#" data-theme="b" id="DiferencialDisponible" >Disponible: <br> #IMPORTE</a></li>
                </ul>
            </div>


			<h2>Deuda Actual:</h2>
            <h5 style="text-align: right;" class="FechaConsumo" >Deuda al #FECHACONSUMO </h5>
            <h1 style="text-align: right;" class="consumosImporte"> $ #IMPORTE</h1>
            <h5 style="text-align: right;" class="FechaCierre">Cierra el #FECHACIERRE </h5>
			<button  data-theme="b" type="submit" id="detalleConsumo" onclick="javascript:siguiente('#verDetalle');" >Ver Detalle</button>

    		<div style="height: 10em;"></div>
		</div>
    </div><!-- /content -->
</div><!-- /page -->

<!-- Start of cuarta page -->
<div data-role="page" id="verDetalle">
	<div class="CabeceraDetalleVolver"></div>
    <div role="main" class="ui-content">
		<div class="div_contenido">
			<h2>Consumos:</h2>
            <h5 style="text-align: right;" class="FechaConsumo" >Deuda al #FECHACONSUMO </h5>
            <h1 style="text-align: right;" class="consumosImporte"> $ #IMPORTE</h1>
            <h5 style="text-align: right;" class="FechaCierre">Cierra el #FECHACIERRE </h5>
			<h5>Ultimas Compras registradas:</h5>
            <div id="tablaDeConsumos" name="tablaDeConsumos"> <p>Sin Consumos Pendientes de Liquidar</p></div>

    		<div style="height: 10em;"></div>
		</div>
    </div><!-- /content -->
</div><!-- /page -->

<!-- Start of quinta page -->
<div data-role="page" id="resumenes">
    <div class="CabeceraPrincipal">  </div>
      <div role="main" class="ui-content">
      	<div class="div_contenido">
			<h2>Ultimo Resumen:</h2>
            <h5 style="text-align: right;" class="FechaVtoResumen">Vencimiento al #FECHAVTORESUMEN </h5>
            <h1 style="text-align: right;" class="ImporteResumen"> $ #IMPORTE</h1>
			<button  data-theme="b" type="submit" id="btnDetalleResumen" onclick="javascript:siguiente('#verDetalleResumen');" >Ver Detalle</button>
			<h2>Proximo Resumen</h2>
			<div data-role="navbar" >
      			<ul>
        			<li><a href="#" data-theme="b" class="ProximoCierre" >Cierre: <br> #FechaCierre </a></li>
        			<li><a href="#" data-theme="b" class="ProximoVto">Vencimiento: <br> #FechaVto</a></li>
      			</ul>
    		</div>
			
    		<div style="height: 10em;"></div>
		</div>
    </div><!-- /content -->
</div><!-- /page -->

<!-- Start of sexta page -->
<div data-role="page" id="verDetalleResumen">
    <div class="CabeceraDetalleVolver"></div>
    <div role="main" class="ui-content">
		<div class="div_contenido">
			<h5 style="text-align: right;" class="FechaVtoResumen">Vencimiento al #FECHAVTORESUMEN </h5>
			<h1 style="text-align: right;" class="ImporteResumen"> $ #IMPORTE</h1>
			<h5>Ultimos Resumenes:</h5>
			<div id="tablaResumen" name="tablaResumen"></div>
			
    		<div style="height: 10em;"></div>
		</div>
    </div><!-- /content -->
</div><!-- /page -->

<!-- Start of second page -->
<div data-role="page" id="detalle">
    <div data-role="header">
        <h1>Bar</h1>
        <a href="#" data-rel="back" class="ui-btn ui-btn-right ui-btn-b ui-btn-icon-notext ui-icon-delete ui-corner-all">Close</a>
    </div><!-- /header -->

    <div role="main" class="ui-content">
        <div id="dataDetalle" name="dataDetalle">

            <label for="Vencimiento" >Vencimiento</label>
            <input type="text"  name="Vencimiento" id="Vencimiento" placeholder="Vencimiento" value="">
            <label for="TotalAPagar" >TotalAPagar</label>
            <input type="text"  name="TotalAPagar" id="TotalAPagar" placeholder="TotalAPagar" value="">
            <label for="TotalAPagar2doVenc" >TotalAPagar2doVenc</label>
            <input type="text"  name="TotalAPagar2doVenc" id="TotalAPagar2doVenc" placeholder="TotalAPagar2doVenc" value="">
            <a  href="#"  name="Archivo" id="Archivo" >Descargar</a>
        </div>

    </div><!-- /content -->

    <div data-role="footer">
        <h4>Page Footer</h4>
    </div><!-- /footer -->
</div><!-- /page -->

<div data-role="page" id="pagos" rel="external" >
    <div class="CabeceraPrincipal">  </div>
    <div role="main" class="ui-content">
        <div class="div_contenido">
            <h5 class="LeyendaUltimosPagos">Ultimos Pagos:</h5>
            <div id="tablaPagos" name="tablaPagos"></div>


            <div style="height: 10em;"></div>
        </div>
    </div><!-- /content -->
</div><!-- /page -->




<script type="text/javascript">
		     $(document).ready(function () {
		        cargarEstructuraPagina();
                 $('#verDetalle').find('.TituloDetalle').text('Detalle de Consumos');
                 $('#verDetalleResumen').find('.TituloDetalle').text('Detalle de Resumenes');

                //Android.getResumenes('cargarTabla');

              });

            $(document).on('pageshow', '#pagos',function (){
                 console.log("JS: al cargar Pagos ");
                 MainActivity.buscarPagos('pagosVolver');
            });

            function pagosVolver(data){
                console.log("JS: pagosVolver "+data);
                var obj = jQuery.parseJSON(data);
                if(obj.RequestsStatusOK) {

                $('.LeyendaUltimosPagos').html('<p>'+obj.LeyendaGeneral+' </p>');
                    tablainicio = "<table data-role='table' id='table-pagos' data-mode='columntoggle' class='ui-body-d ui-shadow table-stripe ui-responsive' data-column-btn-theme='b' data-column-btn-text='Mostrar las Columnas' data-column-popup-theme='a'><thead>"
                     +"<tr class='ui-bar-d' > "
                        +" <th data-priority='2'>Codigo</th> "
                        +" <th data-priority='7'>Medio Pago</th> "
                        +"<th data-priority='7'>Fecha</th>"
                        +"<th data-priority='3'>Fecha Recepcion</th>"
                        +"<th data-priority='7'>Importe</th> "

                     +"</tr> </thead> <tbody>";
                     //console.log("pagosVolver " + obj.Cobros);

                     var tablacontenido = "";
                     var a = obj.Cobros;

                      for ( var i = 0; i < a.length; i++ ) {
                            uno = a[i];
                            //console.log("pagosVolver " + uno.idCobro);
                            tablacontenido +="<tr>"
                            +"<td>"+uno.idCobro+"</td>"
                            +"<td>"+uno.MedioPago+"</td>"
                            +"<td>"+uno.FechaCancelacion+"</td>"
                            +"<td>"+uno.FechaRecepcion+"</td>"
                            +"<td>"+uno.Importe+"</td>"
                            +"</tr>";
                        }

                       tablafin = " </tbody>   </table>";
                       texto =tablainicio+tablacontenido+tablafin;
                       $("#tablaPagos").append(texto);
                       $("#tablaPagos").trigger("create");
                }
            }

            function verificarLogin(irA){
                 MainActivity.login(irA,null);
            }

            function cerrarSession(irA){
                MainActivity.cerrarSession(irA);
            }
            function login(irA){
                data = JSON.stringify($("#formLogin").serializeObject());
                // var obj = { Name : 'Tejasvi', Age: 100};
                //console.log("Lala" + JSON.stringify($("#formLogin").serializeObject()));
                //var str = JSON.stringify(obj);
                console.log("Login "+ data);
                MainActivity.login(irA,data);
            }

            function loginVolver(dataCuenta,dataConsumo,dataCierres,dataResumen){
                console.log("JS: loginVolver dataCuenta" + dataCuenta);
                console.log("JS: loginVolver dataConsumo" + dataConsumo);
                console.log("JS: loginVolver dataCierres" + dataCierres);
                console.log("JS: loginVolver dataResumen" + dataResumen);
                var obj = jQuery.parseJSON(dataCuenta);
                if(obj.RequestsStatusOK) {
                    obj = obj.InfoCuenta;
                	var now = new Date();
                	//console.log("JS: loginVolver now.getDate().length+1 " + now.getDate());
                    now = (now.getDate() > 9  ? now.getDate() : '0' + now.getDate() ) +'/'+ ((now.getMonth().length+1) === 1  ? (now.getMonth()+1) : '0' + (now.getMonth()+1)) +'/'+now.getFullYear();
                    $('.bar_Bienvenida').html('Hola '+obj.F_Nombres);
                    $('.FechaConsumo').html('<p> Deuda al '+now+' </p>');
                    $('#TotalLimite').html('<p>Limite: <br> '+obj.LimiteBase+'</p>');
                    $('#TotalDisponible').html('<p>Disponible: <br> '+obj.DisponibleBase+'</p>');
                    $('#DiferencialLimite').html('<p>Limite: <br> '+obj.LimiteDiferencial+'</p>');
                    $('#DiferencialDisponible').html('<p>Disponible: <br> '+obj.DisponibleDiferencial+'</p>');

                     importeConsumo = cargarTablaConsumo(dataConsumo);
                     var importeConsumo = obj.DEUDA_Actual;

                     $('.consumosImporte').html('<p> $ '+importeConsumo+'</p>');
                     objCierres = jQuery.parseJSON(dataCierres);
                     //console.log("JS: loginVolver " + objCierres.Cierres);
                    if(objCierres.Cierres.length > 0) {
                        $('.FechaCierre').html('<p> Cierra el '+objCierres.Cierres[0].Cierre+' </p>');
                        $('.ProximoCierre').html('Cierre: <br>'+ objCierres.Cierres[0].Cierre);
                         $('.ProximoVto').html('Vencimiento: <br> '+ objCierres.Cierres[0].Vencimiento);
                        //console.log("JS: loginVolver " + objCierres.Cierres[0]);

                    }
                    cargarInfoResumen(dataResumen);
                    siguiente('#bienvenida');
                } else {
                    //F_Nombres

                }
            }
            function cargarInfoResumen(data){
            //console.log("cargarTabla " + data);
                var obj = jQuery.parseJSON(data);
                if(obj.RequestsStatusOK){
                    var a = obj.Resumenes;
                    if(a.length > 0) {
                        $('.FechaVtoResumen').html('<p> Vence el '+a[0].Vencimiento+' </p>');
                        $('.ImporteResumen').html('<p> Total A Pagar $ '+a[0].TotalAPagar+' <br> 2do.Vto. $'+a[0].TotalAPagar2doVenc+'</p>');

//Periodo, Vto y PrimerVto
                        tablainicio = "<table data-role='table' id='table-resumen' data-mode='columntoggle' class='ui-body-d ui-shadow table-stripe ui-responsive' data-column-btn-theme='b' data-column-btn-text='Mostrar las Columnas' data-column-popup-theme='a'><thead>"
                     +"<tr class='ui-bar-d' > "
                     +" <th data-priority='2'>Codigo</th> "
                     +" <th data-priority='3'>Archivo</th> "
                     +"<th data-priority='7'>Periodo </th>"
                     +"<th data-priority='7'>Vto.</th>"
                     +"<th data-priority='7'>1erVto</th>"
                     +"<th data-priority='6'>2do Vto</th> "
                     +"<th data-priority='7'>Op</th> "
                     +"</tr> </thead> <tbody>";
                    //console.log("cargarTabla " + obj.Resumenes);
                    tablacontenido = "";
                    var a = obj.Resumenes;
                    for ( var i = 0; i < a.length; i++ ) {
                            //console.log("cargarTabla " + a[i].idResumen);
                            tablacontenido +="<tr><th>"+a[i].idResumen+"</th><td class='title'><a href='http://usuarios.crediguia.com.ar:31561/"+a[i].Archivo+"' data-rel='external'>Resumen</a></td>"
                            +"<td>"+a[i].Periodo+"</td>"
                            +"<td>"+a[i].Vencimiento+"</td>"
                            +"<td>"+a[i].TotalAPagar+"</td>"
                            +"<td>"+a[i].TotalAPagar2doVenc+"</td>"
                            +"<td><a href='javascript:showResumen("+JSON.stringify(a[i])+")' class='ui-btn ui-shadow ui-corner-all ui-icon-info ui-btn-icon-notext'></a>"
                            +"</tr>";
                       }
                       tablafin = " </tbody>   </table>";
                       texto =tablainicio+tablacontenido+tablafin;
                       $("#tablaResumen").append(texto);
                       $("#tablaResumen").trigger("create");



                    }


                }
            }

            function showResumen(data){
                console.log("showResumen " + data.idResumen);
                 $('#Vencimiento').val(data.Vencimiento);
                 $('#Periodo').val(data.Periodo);
                 $('#TotalAPagar').val(data.TotalAPagar);
                 $('#TotalAPagar2doVenc').val(data.TotalAPagar2doVenc);
                 $('#Archivo').attr('href', "https://drive.google.com/viewer?url=http://usuarios.crediguia.com.ar:31561/"+data.Archivo);
                 $( ":mobile-pagecontainer" ).pagecontainer( "change", "#detalle", {
                 transition: "slide",
                reverse: true
                });
            }

            function cargarTablaConsumo(data){
                //console.log("cargarTabla " + data);
                var obj = jQuery.parseJSON(data);
                var importe = 0;
                if(obj.RequestsStatusOK){

                tablainicio = "<table data-role='table' id='table-consumo' data-mode='columntoggle' class='ui-body-d ui-shadow table-stripe ui-responsive' data-column-btn-theme='b' data-column-btn-text='Mostrar las Columnas' data-column-popup-theme='a'><thead>"
                     +"<tr class='ui-bar-d' > "
                        +" <th data-priority='2'>NroAutorizacion</th> "
                        +" <th data-priority='7'>Fecha</th> "
                        +"<th data-priority='7'>Comercio</th>"
                        +"<th data-priority='3'>Domicilio</th>"
                        +"<th data-priority='7'>Cuotas</th> "
                        +"<th data-priority='7'>Importe</th>"

                        +"<th data-priority='2'>Nombre</th> "
                     +"</tr> </thead> <tbody>";
                     //console.log("cargarTabla " + obj.Consumos);

                     var tablacontenido = "";
                     var a = obj.Consumos;

                      for ( var i = 0; i < a.length; i++ ) {
                            uno = a[i];
                            //console.log("cargarTabla " + uno.NroAutorizacion);
                            tablacontenido +="<tr>"
                            +"<td>"+uno.NroAutorizacion+"</td>"
                            +"<td>"+uno.Fecha+"</td>"
                            +"<td>"+uno.Comercio+"</td>"
                            +"<td>"+uno.Domicilio+"</td>"
                            +"<td>"+uno.Cuotas+"</td>"
                            +"<td>"+uno.Importe+"</td>"

                            +"<td>"+uno.Nombre+"</td>"
                            +"</tr>";

                            importe +=uno.Importe;
                            if(i < 1) $("#tablaDeConsumos").html("");
                       }

                       tablafin = " </tbody>   </table>";
                       texto =tablainicio+tablacontenido+tablafin;
                       $("#tablaDeConsumos").append(texto);
                       $("#tablaDeConsumos").trigger("create");

                }
                return importe;
            }

           
        </script>
</body>
</html>